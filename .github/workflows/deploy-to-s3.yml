name: deploy-to-s3

on:
  push:
    branches: [ "main" ]

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    runs-on: ubuntu-latest

    env:
      AWS_REGION: ap-northeast-2
      S3_BUCKET: xim-static-test
      DEPLOY_DIR: .

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Configure AWS credentials (OIDC)
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: arn:aws:iam::996621491488:role/GitHubActionsS3Role
          aws-region: ${{ env.AWS_REGION }}

      - name: Verify identity
        run: aws sts get-caller-identity

      # ✅ 필요한 파일만 업로드 (index.html, index2.html만)
      - name: Upload only html files
        run: |
          aws s3 cp "${DEPLOY_DIR}/index.html"  "s3://${S3_BUCKET}/index.html"  --only-show-errors
          aws s3 cp "${DEPLOY_DIR}/index2.html" "s3://${S3_BUCKET}/index2.html" --only-show-errors
